{"ast":null,"code":"import _objectSpread from\"/Users/davidefalcone/Universita/Polito/Web Applications I/exam1-car-rental-davidefalcone1 copia/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _regeneratorRuntime from\"/Users/davidefalcone/Universita/Polito/Web Applications I/exam1-car-rental-davidefalcone1 copia/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/davidefalcone/Universita/Polito/Web Applications I/exam1-car-rental-davidefalcone1 copia/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _classCallCheck from\"/Users/davidefalcone/Universita/Polito/Web Applications I/exam1-car-rental-davidefalcone1 copia/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/Users/davidefalcone/Universita/Polito/Web Applications I/exam1-car-rental-davidefalcone1 copia/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _inherits from\"/Users/davidefalcone/Universita/Polito/Web Applications I/exam1-car-rental-davidefalcone1 copia/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/Users/davidefalcone/Universita/Polito/Web Applications I/exam1-car-rental-davidefalcone1 copia/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";import React from'react';import'./App.css';import{Switch,Route,withRouter,Redirect}from'react-router-dom';import LogInForm from'./components/Login.js';import Header from'./components/Header.js';import AddRentalComponent from'./components/AddRental.js';import RentalList from'./components/RentalList.js';import{AuthContext}from'./AuthContext.js';import CarList from'./components/CarList.js';import*as API from'./api/fetch.js';import{Button,Container,Alert}from'react-bootstrap';var App=/*#__PURE__*/function(_React$Component){_inherits(App,_React$Component);var _super=_createSuper(App);function App(props){var _this;_classCallCheck(this,App);_this=_super.call(this,props);_this.login=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(email,password){var user,rentals,error;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;_context.next=3;return API.login(email,password);case 3:user=_context.sent;_context.next=6;return API.rentalList();case 6:rentals=_context.sent;_this.setState({authUser:user,rentals:rentals,authError:undefined});_this.setAlert(false,\"Welcome, \".concat(_this.state.authUser.name));_this.props.history.push('/public');return _context.abrupt(\"return\",true);case 13:_context.prev=13;_context.t0=_context[\"catch\"](0);_context.t1=_context.t0;_context.next=_context.t1==='Wrong password'?18:_context.t1==='Invalid e-mail'?20:22;break;case 18:error=1;return _context.abrupt(\"break\",24);case 20:error=2;return _context.abrupt(\"break\",24);case 22:error=3;return _context.abrupt(\"break\",24);case 24:_this.setState({authError:error});if(error===3)_this.setAlert(true,'Sorry, something went wrong. Try again.');return _context.abrupt(\"return\",false);case 27:case\"end\":return _context.stop();}}},_callee,null,[[0,13]]);}));return function(_x,_x2){return _ref.apply(this,arguments);};}();_this.logout=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var username;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.prev=0;_context2.next=3;return API.logout();case 3:username=_this.state.authUser.name;_this.props.history.push('/public');_this.setState({authUser:undefined,rentals:undefined});_this.setAlert(false,\"Goodbye, \".concat(username));_context2.next=12;break;case 9:_context2.prev=9;_context2.t0=_context2[\"catch\"](0);_this.setState({authError:undefined});case 12:case\"end\":return _context2.stop();}}},_callee2,null,[[0,9]]);}));_this.requestAdd=function(){_this.props.history.push('/add');};_this.addRental=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(rental){var r;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_this.props.history.push('/myrentals');_context3.prev=1;_this.setState({loading:true});_context3.next=5;return API.addRental(rental);case 5:r=_context3.sent;_this.setState(function(state){var list=state.rentals;if(!list.includes(r))list.push(r);return _objectSpread(_objectSpread({},state),{},{rentals:list,loading:false});});_this.setAlert(false,'Your reservation has been correctly submitted.');_context3.next=13;break;case 10:_context3.prev=10;_context3.t0=_context3[\"catch\"](1);_this.setAlert(true,'We cannot add your reservation right now. Try again.');case 13:case\"end\":return _context3.stop();}}},_callee3,null,[[1,10]]);}));return function(_x3){return _ref3.apply(this,arguments);};}();_this.openPaymentStub=function(total){_this.setState({total:total});_this.props.history.push('/add/payment');};_this.setAlert=function(alertErr/* is an error message ? */,alertMsg){_this.setState({alert:{showAlert:true,alertErr:alertErr,alertMsg:alertMsg}});setTimeout(function(){_this.setState({alert:{showAlert:false,alertMsg:undefined,alertErr:undefined}});},3000);};_this.deleteRental=/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(rental){return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:try{API.deleteRental(rental);_this.setState(function(state){var newList=state.rentals.filter(function(r){return r.id!==rental.id;});return _objectSpread(_objectSpread({},state),{},{rentals:newList});});_this.setAlert(false,'Your rental has been deleted.');}catch(e){_this.setAlert(true,'We cannot delete your rental right now. Try again.');}case 1:case\"end\":return _context4.stop();}}},_callee4);}));return function(_x4){return _ref4.apply(this,arguments);};}();_this.state={news:undefined,total:undefined,/* This is the amount to pay for a new rental.\n        AddRentalComponent calls openPaymentStub() and provides the total to pay.\n        App opens the payment stub. Another possible solution could be to not pass\n        through App and let AddRentalComponent to open directly PaymentStub. */authUser:undefined,authError:undefined,/* Used mainly to notify LogInForm about the TYPE of a login error.\n       The EXISTENCE of the error is indicated by the return value of login() */rentals:[],cars:[],alert:{showAlert:false,alertErr:undefined/* is an error message ?*/,alertMsg:undefined},loading:true};return _this;}_createClass(App,[{key:\"componentDidMount\",value:function componentDidMount(){var _this2=this;/* Fetch news */API.getNews().then(function(news){_this2.setState({news:news});}).catch(function(e){_this2.setAlert(true,'Sorry, something went wrong. Try again.');});/* Fetch cars */API.carList().then(function(cars){_this2.setState({cars:cars});}).catch(function(e){_this2.setAlert(true,'Sorry, something went wrong. Try again.');});/* Check if the user is already logged in */API.isLogged().then(/*#__PURE__*/function(){var _ref5=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee5(user){return _regeneratorRuntime.wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:_context5.t0=_this2;_context5.t1=user;_context5.next=4;return API.rentalList();case 4:_context5.t2=_context5.sent;_context5.t3={loading:false,authUser:_context5.t1,rentals:_context5.t2};_context5.t0.setState.call(_context5.t0,_context5.t3);case 7:case\"end\":return _context5.stop();}}},_callee5);}));return function(_x5){return _ref5.apply(this,arguments);};}()).catch(function(e){_this2.props.history.push('/public');_this2.setState({loading:false});});}},{key:\"render\",value:function render(){var _this3=this;/* Make available the current user and function for both log in and log out to the entire application */var value={authUser:this.state.authUser,authError:this.state.authError,login:this.login,logout:this.logout};if(this.state.loading)return/*#__PURE__*/React.createElement(Container,{className:\"h-100 d-flex justify-content-center align-items-center\"},/*#__PURE__*/React.createElement(\"div\",{className:\"display-4\"},\"Loading..\"));return/*#__PURE__*/React.createElement(AuthContext.Provider,{value:value},/*#__PURE__*/React.createElement(Switch,null,/*#__PURE__*/React.createElement(Route,{path:\"/login\"},/*#__PURE__*/React.createElement(LogInForm,null),this.state.alert.showAlert?/*#__PURE__*/React.createElement(Container,{fluid:true,className:\"fixed-bottom d-flex mb-3 align-items-center\"},/*#__PURE__*/React.createElement(Alert,{className:\"mx-auto\",variant:this.state.alert.alertErr?'danger':'success'},this.state.alert.alertMsg)):null),/*#__PURE__*/React.createElement(Route,{path:\"/public\"},/*#__PURE__*/React.createElement(Header,null),/*#__PURE__*/React.createElement(CarList,{news:this.state.news,cars:this.state.cars}),/*#__PURE__*/React.createElement(Container,{fluid:true,className:\"fixed-bottom d-flex mb-3\"},this.state.alert.showAlert?/*#__PURE__*/React.createElement(Alert,{className:\"mx-auto\",variant:this.state.alert.alertErr?'danger':'success'},this.state.alert.alertMsg):null)),/*#__PURE__*/React.createElement(Route,{path:\"/myrentals\"},/*#__PURE__*/React.createElement(Header,null),/*#__PURE__*/React.createElement(RentalList,{news:this.state.news,deleteRental:this.deleteRental,rentals:this.state.rentals}),/*#__PURE__*/React.createElement(Container,{fluid:true,className:\"fixed-bottom d-flex mb-3 align-items-center\"},this.state.alert.showAlert?/*#__PURE__*/React.createElement(Alert,{className:\"mx-auto\",variant:this.state.alert.alertErr?'danger':'success'},this.state.alert.alertMsg):null,/*#__PURE__*/React.createElement(Button,{variant:\"danger\",size:\"lg\",className:\"ml-auto rounded-circle mr-3\",onClick:function onClick(){_this3.requestAdd();}},\"+\"))),/*#__PURE__*/React.createElement(Route,{path:\"/add\"},/*#__PURE__*/React.createElement(Header,null),/*#__PURE__*/React.createElement(AddRentalComponent,{setAlert:this.setAlert/* Is passed to handle fetch errors */,openPaymentStub:this.openPaymentStub,addRental:this.addRental}),this.state.alert.showAlert?/*#__PURE__*/React.createElement(Container,{fluid:true,className:\"fixed-bottom d-flex mb-3 align-items-center\"},/*#__PURE__*/React.createElement(Alert,{className:\"mx-auto\",variant:this.state.alert.alertErr?'danger':'success'},this.state.alert.alertMsg)):null),/*#__PURE__*/React.createElement(Route,null,/*#__PURE__*/React.createElement(Redirect,{to:\"/public\"}))));}}]);return App;}(React.Component);export default withRouter(App);","map":{"version":3,"sources":["/Users/davidefalcone/Universita/Polito/Web Applications I/exam1-car-rental-davidefalcone1 copia/client/src/App.js"],"names":["React","Switch","Route","withRouter","Redirect","LogInForm","Header","AddRentalComponent","RentalList","AuthContext","CarList","API","Button","Container","Alert","App","props","login","email","password","user","rentalList","rentals","setState","authUser","authError","undefined","setAlert","state","name","history","push","error","logout","username","requestAdd","addRental","rental","loading","r","list","includes","openPaymentStub","total","alertErr","alertMsg","alert","showAlert","setTimeout","deleteRental","newList","filter","id","e","news","cars","getNews","then","catch","carList","isLogged","value","Component"],"mappings":"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","sourcesContent":["import React from 'react';\nimport './App.css';\nimport {Switch, Route, withRouter, Redirect} from 'react-router-dom';\nimport LogInForm from './components/Login.js';\nimport Header from './components/Header.js';\nimport AddRentalComponent from './components/AddRental.js';\nimport RentalList from './components/RentalList.js';\nimport {AuthContext} from './AuthContext.js';\nimport CarList from './components/CarList.js';\nimport * as API from './api/fetch.js';\nimport {Button, Container, Alert} from 'react-bootstrap';\n\nclass App extends React.Component{\n  constructor(props){\n    super(props);\n    this.state = {\n      news: undefined,\n      total: undefined, /* This is the amount to pay for a new rental.\n        AddRentalComponent calls openPaymentStub() and provides the total to pay.\n        App opens the payment stub. Another possible solution could be to not pass\n        through App and let AddRentalComponent to open directly PaymentStub. */\n      authUser : undefined,\n      authError: undefined, /* Used mainly to notify LogInForm about the TYPE of a login error.\n       The EXISTENCE of the error is indicated by the return value of login() */\n      rentals: [],\n      cars: [],\n      alert: {\n        showAlert: false,\n        alertErr: undefined /* is an error message ?*/,\n        alertMsg: undefined\n      },\n      loading: true\n    };\n  }\n  componentDidMount(){\n    /* Fetch news */\n    API.getNews()\n      .then((news) => {this.setState({news})})\n      .catch((e)=>{this.setAlert(true, 'Sorry, something went wrong. Try again.');});\n    /* Fetch cars */\n    API.carList()\n      .then((cars)=>{this.setState({cars})})\n      .catch((e)=>{this.setAlert(true, 'Sorry, something went wrong. Try again.');})\n    /* Check if the user is already logged in */\n    API.isLogged()\n      .then(async(user) => {this.setState({loading:false, authUser: user, rentals: await API.rentalList()})})\n      .catch((e) => {this.props.history.push('/public'); this.setState({loading: false})});\n  }\n  render(){\n    /* Make available the current user and function for both log in and log out to the entire application */\n    const value = {\n      authUser: this.state.authUser,\n      authError: this.state.authError,\n      login: this.login,\n      logout: this.logout\n    }\n    if(this.state.loading)\n      return (\n        <Container className = 'h-100 d-flex justify-content-center align-items-center'>\n          <div className = 'display-4'>Loading..</div>\n        </Container>\n      );\n    return (\n      <AuthContext.Provider value = {value}>\n        <Switch>\n\n          <Route path = '/login'>\n            <LogInForm/>\n            {\n              this.state.alert.showAlert\n              ?\n              <Container fluid className = 'fixed-bottom d-flex mb-3 align-items-center'>\n                <Alert className = 'mx-auto' variant = {this.state.alert.alertErr ? 'danger' : 'success'}>{this.state.alert.alertMsg}</Alert>\n              </Container>\n              :\n              null\n            }\n          </Route>\n\n          <Route path = '/public'>\n            <Header/>\n            <CarList news = {this.state.news} cars = {this.state.cars}/>\n            <Container fluid className = 'fixed-bottom d-flex mb-3'>\n              {\n                this.state.alert.showAlert\n                ?\n                <Alert className = 'mx-auto' variant = {this.state.alert.alertErr ? 'danger' : 'success'}>{this.state.alert.alertMsg}</Alert>\n                :\n                null\n              }\n            </Container>\n          </Route>\n\n          <Route path = '/myrentals'>\n            <Header/>\n            <RentalList news = {this.state.news} deleteRental = {this.deleteRental} rentals = {this.state.rentals}/>\n            <Container fluid className = 'fixed-bottom d-flex mb-3 align-items-center'>\n              {\n                this.state.alert.showAlert\n                ?\n                <Alert className = 'mx-auto' variant = {this.state.alert.alertErr ? 'danger' : 'success'}>{this.state.alert.alertMsg}</Alert>\n                :\n                null\n              }\n              <Button variant = 'danger' size = 'lg' className = 'ml-auto rounded-circle mr-3' onClick = {()=>{this.requestAdd();}}>+</Button>\n            </Container>\n          </Route>\n\n          <Route path = '/add'>\n            <Header/>\n            <AddRentalComponent setAlert = {this.setAlert /* Is passed to handle fetch errors */} openPaymentStub = {this.openPaymentStub} addRental = {this.addRental}/>\n            {\n              this.state.alert.showAlert\n              ?\n              <Container fluid className = 'fixed-bottom d-flex mb-3 align-items-center'>\n                <Alert className = 'mx-auto' variant = {this.state.alert.alertErr ? 'danger' : 'success'}>{this.state.alert.alertMsg}</Alert>\n              </Container>\n              :\n              null\n            }\n          </Route>\n\n          <Route>\n            <Redirect to = '/public'/>\n          </Route>\n        </Switch>\n      </AuthContext.Provider>\n    );\n  }\n  login = async (email, password) => {\n    try {\n      const user = await API.login(email, password);\n      const rentals = await API.rentalList();\n      this.setState({authUser: user, rentals: rentals, authError: undefined});\n      this.setAlert(false, `Welcome, ${this.state.authUser.name}`)\n      this.props.history.push('/public');\n      return true;\n    } catch (e) {\n      let error;\n      switch (e) {\n        case 'Wrong password':\n          error = 1;\n          break;\n        case 'Invalid e-mail':\n          error = 2;\n          break;\n        default:\n          error = 3;\n          break;\n      }\n      this.setState({authError: error});\n      if(error === 3)\n        this.setAlert(true, 'Sorry, something went wrong. Try again.');\n      return false; /* Return false to signal an error, put error code in authError */\n    }\n  }\n  logout = async () => {\n    try {\n      await API.logout();\n      const username = this.state.authUser.name;\n      this.props.history.push('/public');\n      this.setState({authUser: undefined, rentals: undefined});\n      this.setAlert(false, `Goodbye, ${username}`);\n    } catch (e) {\n      this.setState({authError: undefined});\n    }\n  }\n  requestAdd = () => {\n    this.props.history.push('/add');\n  }\n  addRental = async(rental) => {\n    this.props.history.push('/myrentals');\n    try {\n      this.setState({loading: true});\n      const r = await API.addRental(rental);\n      this.setState((state) => {\n        const list = state.rentals;\n        if(!list.includes(r))\n          list.push(r);\n        return {...state, rentals: list, loading: false};\n      });\n      this.setAlert(false, 'Your reservation has been correctly submitted.');\n    } catch (e) {\n      this.setAlert(true, 'We cannot add your reservation right now. Try again.');\n    }\n  }\n  openPaymentStub = (total) => {\n    this.setState({total});\n    this.props.history.push('/add/payment');\n  }\n  setAlert = (alertErr /* is an error message ? */, alertMsg) => {\n    this.setState({alert: {showAlert: true, alertErr, alertMsg}});\n    setTimeout(()=>{\n      this.setState(\n        {\n          alert: {\n            showAlert: false,\n            alertMsg: undefined,\n            alertErr: undefined\n          }\n        })\n    }, 3000);\n  }\n  deleteRental = async (rental) => {\n    try {\n      API.deleteRental(rental);\n      this.setState((state) => {\n        const newList = state.rentals.filter(r => r.id !== rental.id);\n        return {...state, rentals: newList};\n      });\n      this.setAlert(false, 'Your rental has been deleted.');\n    } catch (e) {\n      this.setAlert(true, 'We cannot delete your rental right now. Try again.');\n    }\n  }\n}\n\nexport default withRouter(App);\n"]},"metadata":{},"sourceType":"module"}