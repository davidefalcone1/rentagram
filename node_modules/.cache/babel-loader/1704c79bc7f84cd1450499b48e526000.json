{"ast":null,"code":"import _regeneratorRuntime from\"/Users/davidefalcone/Universita/Polito/Web Applications I/exam1-car-rental-davidefalcone1 copia/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _slicedToArray from\"/Users/davidefalcone/Universita/Polito/Web Applications I/exam1-car-rental-davidefalcone1 copia/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import _asyncToGenerator from\"/Users/davidefalcone/Universita/Polito/Web Applications I/exam1-car-rental-davidefalcone1 copia/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _defineProperty from\"/Users/davidefalcone/Universita/Polito/Web Applications I/exam1-car-rental-davidefalcone1 copia/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";import _objectSpread from\"/Users/davidefalcone/Universita/Polito/Web Applications I/exam1-car-rental-davidefalcone1 copia/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _classCallCheck from\"/Users/davidefalcone/Universita/Polito/Web Applications I/exam1-car-rental-davidefalcone1 copia/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/Users/davidefalcone/Universita/Polito/Web Applications I/exam1-car-rental-davidefalcone1 copia/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _inherits from\"/Users/davidefalcone/Universita/Polito/Web Applications I/exam1-car-rental-davidefalcone1 copia/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/Users/davidefalcone/Universita/Polito/Web Applications I/exam1-car-rental-davidefalcone1 copia/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";import React from'react';import RentalForm from'./RentalForm.js';import*as API from'../api/fetch.js';import moment from'moment';import{Route,Switch}from'react-router-dom';import{AuthContext}from'../AuthContext.js';import PaymentStub from'./PaymentStub.js';import{Container,Row,Col,Button,Form}from'react-bootstrap';var AddRentalComponent=/*#__PURE__*/function(_React$Component){_inherits(AddRentalComponent,_React$Component);var _super=_createSuper(AddRentalComponent);function AddRentalComponent(props){var _this;_classCallCheck(this,AddRentalComponent);_this=_super.call(this,props);_this.updateField=function(name,value){_this.setState(function(state){var newRental=_objectSpread(_objectSpread({},state.rental),{},_defineProperty({},name,value));return{rental:newRental};});};_this.computeTotal=function(newRental,availableCars){var total=0,fee=0;var startDate=moment(newRental.startDate,'YYYY-MM-DD');var endDate=moment(newRental.endDate,'YYYY-MM-DD');var nDays=moment.duration/*Creates a duration object*/(endDate.diff(startDate)/* Gets the milliseconds between the 2 moments */).as('days')/* Milliseconds as days */;/* Duration and car category */switch(newRental.category){case'A':fee=total+=nDays*_this.state.prices.category[0];break;case'B':fee=total+=nDays*_this.state.prices.category[1];break;case'C':fee=total+=nDays*_this.state.prices.category[2];break;case'D':fee=total+=nDays*_this.state.prices.category[3];break;case'E':fee=total+=nDays*_this.state.prices.category[4];break;default:return[undefined,undefined];}/* Driver age */if(parseInt(newRental.driverAge)>65)total+=fee*_this.state.prices.driverAge[1];else if(parseInt(newRental.driverAge)<25)total+=fee*_this.state.prices.driverAge[0];/* Extra drivers */total+=fee*(newRental.extraDrivers*_this.state.prices.extraDriver);/* Extra insurance */total+=fee*(newRental.insurance?_this.state.prices.insurance:0);/* Estimated km */if(newRental.km==='0')total+=fee*_this.state.prices.km[0];else if(newRental.km==='2')total+=fee*_this.state.prices.km[1];/* Less than 10% available cars */if(availableCars.fewCars)total+=fee*_this.state.prices.fewCars;return[total,total+total*_this.state.prices.promo];};_this.tryAddRental=function(){_this.props.addRental(_this.state.rental);};_this.handleSubmit=function(e){e.preventDefault();e.stopPropagation();var form=e.currentTarget;if(form.checkValidity())_this.props.openPaymentStub(_this.state.totalPromo||_this.state.total);else{_this.setState({validated:true});}};_this.state={loading:true,availableCars:undefined,/* It is an object with the number of available cars and a boolean that indicates if are available less than 10% cars*/prices:undefined,/* Object which contains all the prices. It is used to compute the total and is also passed to RentalForm */total:undefined,/* Total according to current configuration */totalPromo:undefined,/* Total with frequent user promo. It is undefined if the user is not a frequent user. It is used in order to show both the total and the total with promo */validated:false,rental:{startDate:moment().add(1,'days').format('YYYY-MM-DD'),/* Initial value is tomorrow */endDate:moment().add(2,'days').format('YYYY-MM-DD'),/* Initial value is the day after tomorrow */driverAge:'',extraDrivers:'',km:'',/* 0 means less than 50 km, 1 means between 50 and 150, 2 means unlimited km per day */insurance:false,category:''}};return _this;}_createClass(AddRentalComponent,[{key:\"componentDidMount\",value:function componentDidMount(){var _this2=this;/* Fetch prices */API.getPrices().then(function(prices){_this2.setState({prices:prices,loading:false});}).catch(function(e){_this2.props.setAlert(true,'Sorry, something went wrong. Try again.');});}},{key:\"render\",value:function render(){var _this3=this;if(this.state.loading)return/*#__PURE__*/React.createElement(Container,{className:\"h-100 d-flex justify-content-center align-items-center\"},/*#__PURE__*/React.createElement(\"div\",{className:\"display-4\"},\"Loading..\"));return/*#__PURE__*/React.createElement(Switch,null,/*#__PURE__*/React.createElement(Route,{exact:true,path:\"/add/payment\"},/*#__PURE__*/React.createElement(PaymentStub,{tryAddRental:this.tryAddRental,amount:this.state.hasPromo?this.state.totalPromo:this.state.total/* If the user is a frequent one, then use the total promo instead of total */})),/*#__PURE__*/React.createElement(Route,null,/*#__PURE__*/React.createElement(AuthContext.Consumer,null,function(value){return/*#__PURE__*/React.createElement(Form,{noValidate:true,validated:_this3.state.validated/* If true shows validation messages */,onSubmit:function onSubmit(e){_this3.handleSubmit(e);}},/*#__PURE__*/React.createElement(Form.Row,null,/*#__PURE__*/React.createElement(Col,{xs:12,md:{span:'7',offset:'0'},lg:{span:'5',offset:'1'},xl:{span:'4',offset:'1'}},/*#__PURE__*/React.createElement(RentalForm,{prices:_this3.state.prices,rental:_this3.state.rental,updateField:_this3.updateField})),/*#__PURE__*/React.createElement(Col,{xs:12,md:{span:'4',offset:'0'},lg:{span:'4',offset:'2'},xl:{span:'4',offset:'3'}},/*#__PURE__*/React.createElement(Checkout,{availableCars:_this3.state.availableCars,total:_this3.state.total,totalPromo:_this3.state.totalPromo,hasPromo:value.authUser.hasPromo,promoPercentage:_this3.state.prices&&_this3.state.prices.promo}))));})));}},{key:\"componentDidUpdate\",value:function(){var _componentDidUpdate=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(propsPrec,statePrec){var availableCars,_this$computeTotal,_this$computeTotal2,total,totalPromo,_this$computeTotal3,_this$computeTotal4,_total,_totalPromo;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(!(this.state.rental.startDate!==statePrec.rental.startDate||this.state.rental.endDate!==statePrec.rental.endDate||this.state.rental.category!==statePrec.rental.category)){_context.next=8;break;}_context.next=3;return API.getAvailableCars(this.state.rental.startDate,this.state.rental.endDate,this.state.rental.category);case 3:availableCars=_context.sent;_this$computeTotal=this.computeTotal(this.state.rental,availableCars),_this$computeTotal2=_slicedToArray(_this$computeTotal,2),total=_this$computeTotal2[0],totalPromo=_this$computeTotal2[1];this.setState({availableCars:availableCars,total:total,totalPromo:totalPromo});_context.next=9;break;case 8:if(this.state.rental!==statePrec.rental){/* In this case we do not fetch, we simply update the state */_this$computeTotal3=this.computeTotal(this.state.rental,this.state.availableCars),_this$computeTotal4=_slicedToArray(_this$computeTotal3,2),_total=_this$computeTotal4[0],_totalPromo=_this$computeTotal4[1];this.setState({total:_total,totalPromo:_totalPromo});}case 9:case\"end\":return _context.stop();}}},_callee,this);}));function componentDidUpdate(_x,_x2){return _componentDidUpdate.apply(this,arguments);}return componentDidUpdate;}()}]);return AddRentalComponent;}(React.Component);function Checkout(props){return/*#__PURE__*/React.createElement(Container,{className:\"mb-5 mt-5\"},/*#__PURE__*/React.createElement(Row,null,/*#__PURE__*/React.createElement(Col,null,/* Total is defined only if the user has provided enough information */props.total?/*#__PURE__*/React.createElement(React.Fragment,null,!props.hasPromo?/*#__PURE__*/ /* No Promo */React.createElement(\"div\",{className:\"h4\"},\"Total: \",/*#__PURE__*/React.createElement(\"small\",null,props.total.toFixed(2)+\"€\")):/*#__PURE__*/ /* Promo */React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(\"div\",{className:\"h4\"},\"Subtotal: \",/*#__PURE__*/React.createElement(\"small\",null,props.total.toFixed(2)+\"€\")),/*#__PURE__*/React.createElement(\"div\",{className:\"h4\"},\"Promo: \",/*#__PURE__*/React.createElement(\"small\",null,props.promoPercentage*100+'%')),/*#__PURE__*/React.createElement(\"div\",{className:\"h3\"},\"Total: \",/*#__PURE__*/React.createElement(\"small\",null,props.totalPromo.toFixed(2)+\"€\"))),/*#__PURE__*/React.createElement(\"div\",{className:\"font-weight-light\"},\"Available cars: \",props.availableCars.availableCars&&props.availableCars.availableCars.toString())):/*#__PURE__*/React.createElement(\"div\",{className:\"h3\"},\"Total: 0\\u20AC\")),/*#__PURE__*/React.createElement(Col,null,/*#__PURE__*/React.createElement(Button,{size:\"sm\",type:\"submit\",variant:\"danger\",disabled:props.availableCars&&props.availableCars.availableCars===0/* Make the user able to go on iff at least one car is available */},\"Procede with payment\"))));}export default AddRentalComponent;","map":{"version":3,"sources":["/Users/davidefalcone/Universita/Polito/Web Applications I/exam1-car-rental-davidefalcone1 copia/client/src/components/AddRental.js"],"names":["React","RentalForm","API","moment","Route","Switch","AuthContext","PaymentStub","Container","Row","Col","Button","Form","AddRentalComponent","props","updateField","name","value","setState","state","newRental","rental","computeTotal","availableCars","total","fee","startDate","endDate","nDays","duration","diff","as","category","prices","undefined","parseInt","driverAge","extraDrivers","extraDriver","insurance","km","fewCars","promo","tryAddRental","addRental","handleSubmit","e","preventDefault","stopPropagation","form","currentTarget","checkValidity","openPaymentStub","totalPromo","validated","loading","add","format","getPrices","then","catch","setAlert","hasPromo","span","offset","authUser","propsPrec","statePrec","getAvailableCars","Component","Checkout","toFixed","promoPercentage","toString"],"mappings":"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","sourcesContent":["import React from 'react';\nimport RentalForm from './RentalForm.js';\nimport * as API from '../api/fetch.js';\nimport moment from 'moment';\nimport {Route, Switch} from 'react-router-dom';\nimport {AuthContext} from '../AuthContext.js';\nimport PaymentStub from './PaymentStub.js'\nimport {Container, Row, Col, Button, Form} from 'react-bootstrap';\n\nclass AddRentalComponent extends React.Component {\n  constructor(props){\n    super(props);\n    this.state = {\n      loading: true,\n      availableCars: undefined, /* It is an object with the number of available cars and a boolean that indicates if are available less than 10% cars*/\n      prices: undefined, /* Object which contains all the prices. It is used to compute the total and is also passed to RentalForm */\n      total: undefined, /* Total according to current configuration */\n      totalPromo:undefined, /* Total with frequent user promo. It is undefined if the user is not a frequent user. It is used in order to show both the total and the total with promo */\n      validated: false,\n      rental: {\n        startDate: moment().add(1, 'days').format('YYYY-MM-DD'), /* Initial value is tomorrow */\n        endDate: moment().add(2, 'days').format('YYYY-MM-DD'), /* Initial value is the day after tomorrow */\n        driverAge: '',\n        extraDrivers: '',\n        km: '', /* 0 means less than 50 km, 1 means between 50 and 150, 2 means unlimited km per day */\n        insurance: false,\n        category: ''\n      }\n    };\n  }\n  componentDidMount(){\n    /* Fetch prices */\n    API.getPrices()\n      .then((prices)=>{this.setState({prices, loading: false});})\n      .catch((e)=>{this.props.setAlert(true, 'Sorry, something went wrong. Try again.');});\n  }\n  render(){\n    if(this.state.loading)\n      return (\n        <Container className = 'h-100 d-flex justify-content-center align-items-center'>\n          <div className = 'display-4'>Loading..</div>\n        </Container>\n      );\n    return (\n      <Switch>\n        <Route exact path = '/add/payment'>\n          <PaymentStub tryAddRental = {this.tryAddRental} amount = {this.state.hasPromo ? this.state.totalPromo : this.state.total /* If the user is a frequent one, then use the total promo instead of total */}/>\n        </Route>\n        <Route>\n          <AuthContext.Consumer>\n          {\n            value =>\n            <Form noValidate validated = {this.state.validated /* If true shows validation messages */} onSubmit = {(e)=>{this.handleSubmit(e)}}>\n              <Form.Row>\n                <Col xs = {12} md = {{span: '7', offset: '0'}} lg = {{span: '5', offset: '1'}} xl = {{span: '4', offset: '1'}}>\n                  <RentalForm prices = {this.state.prices} rental = {this.state.rental} updateField = {this.updateField}/>\n                </Col>\n                <Col xs = {12} md = {{span: '4', offset: '0'}} lg = {{span: '4', offset: '2'}} xl = {{span: '4', offset: '3'}}>\n                  <Checkout availableCars = {this.state.availableCars} total = {this.state.total} totalPromo = {this.state.totalPromo} hasPromo = {value.authUser.hasPromo} promoPercentage = {this.state.prices && this.state.prices.promo }/>\n                </Col>\n              </Form.Row>\n            </Form>\n          }\n          </AuthContext.Consumer>\n        </Route>\n      </Switch>\n    );\n  }\n  updateField = (name, value) => {\n    this.setState((state) => {\n      const newRental = {...state.rental, [name]: value};\n      return ({rental: newRental});\n    });\n  }\n\n  async componentDidUpdate(propsPrec, statePrec){\n    if(this.state.rental.startDate !== statePrec.rental.startDate || this.state.rental.endDate !== statePrec.rental.endDate || this.state.rental.category !== statePrec.rental.category){\n      /* Fetch cars only if startDate, endDate and category has changed */\n      const availableCars = await API.getAvailableCars(this.state.rental.startDate, this.state.rental.endDate, this.state.rental.category);\n      const [total, totalPromo] = this.computeTotal(this.state.rental, availableCars);\n      this.setState({availableCars, total, totalPromo});\n    }\n    else if(this.state.rental !== statePrec.rental){\n      /* In this case we do not fetch, we simply update the state */\n       const [total, totalPromo] = this.computeTotal(this.state.rental, this.state.availableCars);\n       this.setState({total, totalPromo});\n    }\n  }\n\n  computeTotal = (newRental, availableCars) => {\n    let total = 0, fee = 0;\n    let startDate = moment(newRental.startDate, 'YYYY-MM-DD');\n    let endDate = moment(newRental.endDate, 'YYYY-MM-DD');\n    let nDays = moment.duration/*Creates a duration object*/(endDate.diff(startDate) /* Gets the milliseconds between the 2 moments */).as('days') /* Milliseconds as days */;\n    /* Duration and car category */\n    switch (newRental.category) {\n      case 'A':\n        fee = total += nDays * this.state.prices.category[0];\n        break;\n      case 'B':\n        fee = total += nDays * this.state.prices.category[1];\n        break;\n      case 'C':\n        fee = total += nDays * this.state.prices.category[2];\n        break;\n      case 'D':\n        fee = total += nDays * this.state.prices.category[3];\n        break;\n      case 'E':\n        fee = total += nDays * this.state.prices.category[4];\n        break;\n      default:\n        return [undefined, undefined];\n    }\n    /* Driver age */\n    if(parseInt(newRental.driverAge) > 65)\n      total += fee * this.state.prices.driverAge[1];\n    else if(parseInt(newRental.driverAge) < 25)\n      total += fee * this.state.prices.driverAge[0];\n    /* Extra drivers */\n    total += fee * (newRental.extraDrivers * this.state.prices.extraDriver);\n    /* Extra insurance */\n    total += fee * (newRental.insurance ? this.state.prices.insurance : 0);\n    /* Estimated km */\n    if(newRental.km === '0')\n      total += fee * this.state.prices.km[0];\n    else if (newRental.km === '2')\n      total += fee * this.state.prices.km[1];\n    /* Less than 10% available cars */\n    if(availableCars.fewCars)\n      total += fee * this.state.prices.fewCars;\n    return [total, total + total * this.state.prices.promo];\n  }\n\n  tryAddRental = () => {\n    this.props.addRental(this.state.rental);\n  }\n\n  handleSubmit = (e) => {\n    e.preventDefault();\n    e.stopPropagation();\n    const form = e.currentTarget;\n    if(form.checkValidity())\n      this.props.openPaymentStub(this.state.totalPromo || this.state.total);\n    else {\n      this.setState({validated: true});\n    }\n  }\n}\nfunction Checkout(props){\n  return (\n    <Container className = 'mb-5 mt-5'>\n      <Row>\n        <Col>\n          {\n            /* Total is defined only if the user has provided enough information */\n            props.total\n            ?\n              <>\n                {\n                  !props.hasPromo\n                  ?\n                  /* No Promo */\n                  <div className = 'h4'>Total: <small>{props.total.toFixed(2) + \"€\"}</small></div>\n                  :\n                  /* Promo */\n                  <>\n                    <div className = 'h4'>Subtotal: <small>{props.total.toFixed(2) + \"€\"}</small></div>\n                    <div className = 'h4'>Promo: <small>{props.promoPercentage * 100 + '%'}</small></div>\n                    <div className = 'h3'>Total: <small>{props.totalPromo.toFixed(2) + \"€\"}</small></div>\n                  </>\n                }\n                <div className = 'font-weight-light'>Available cars: {props.availableCars.availableCars && props.availableCars.availableCars.toString()}</div>\n              </>\n            :\n              <div className = 'h3'>Total: 0€</div>\n          }\n        </Col>\n        <Col>\n          <Button size = 'sm' type = 'submit' variant = 'danger' disabled = {props.availableCars && props.availableCars.availableCars === 0 /* Make the user able to go on iff at least one car is available */}>Procede with payment</Button>\n        </Col>\n      </Row>\n    </Container>\n  );\n}\nexport default AddRentalComponent;\n"]},"metadata":{},"sourceType":"module"}